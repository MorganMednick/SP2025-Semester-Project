generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  notif     Boolean  @default(true)
  password  String
  createdAt DateTime @default(now())

  watchlist UserWatchlist[]
}

model Event {
  id               String    @id
  priceMin        Float?
  priceMax        Float?
  currency        String?
  name            String
  seatLocation    String?
  startTime       String
  saleStart       String?
  saleEnd         String?
  venueName       String?
  venueAddressOne String?
  venueAddressTwo String?
  venueSeatMapSrc String?
  city            String
  country         String
  url             String?
  genre           String?
  imageSrc        String[]

  users UserWatchlist[]
}

enum TicketSites {
  TICKETMASTER
  STUBHUB
  SEATGEEK
}

model WatchedPrice {
  id            Int        @id @default(autoincrement())
  startingPrice Float
  currentPrice  Float
  ticketSite    TicketSites
  watchlist     UserWatchlist @relation(fields: [watchlistId], references: [id])

  watchlistId   Int
}

model UserWatchlist {
  id         Int      @id @default(autoincrement())
  userId     Int      @map("user_id")
  eventId    String   @map("event_id")
  watchStart DateTime @default(now())

  watchedPrices WatchedPrice[]

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId])
}
